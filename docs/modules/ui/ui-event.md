# UI Events

`LrgUIEvent` represents user interactions with the UI system. Events are generated by input and dispatched to widgets for handling.

## Overview

Event types:

- **Mouse Events** - Movement, button press/release
- **Keyboard Events** - Key press/release
- **Scroll Events** - Mouse wheel
- **Focus Events** - Widget focus gain/loss

## Creating Events

### Mouse Move Events

```c
LrgUIEvent *event = lrg_ui_event_new_mouse_move(150.0f, 200.0f);

gfloat x = lrg_ui_event_get_x(event);
gfloat y = lrg_ui_event_get_y(event);

lrg_ui_event_free(event);
```

### Mouse Button Events

```c
LrgUIEvent *press = lrg_ui_event_new_mouse_button(
    LRG_UI_EVENT_MOUSE_BUTTON_DOWN,
    0,  /* left button */
    150.0f, 200.0f
);

gint button = lrg_ui_event_get_button(press);  /* 0=left, 1=right, 2=middle */
gfloat x = lrg_ui_event_get_x(press);
gfloat y = lrg_ui_event_get_y(press);

LrgUIEvent *release = lrg_ui_event_new_mouse_button(
    LRG_UI_EVENT_MOUSE_BUTTON_UP,
    0,
    150.0f, 200.0f
);

lrg_ui_event_free(press);
lrg_ui_event_free(release);
```

### Keyboard Events

```c
LrgUIEvent *key_down = lrg_ui_event_new_key(
    LRG_UI_EVENT_KEY_DOWN,
    GRL_KEY_A
);

GrlKey key = lrg_ui_event_get_key(key_down);

LrgUIEvent *key_up = lrg_ui_event_new_key(
    LRG_UI_EVENT_KEY_UP,
    GRL_KEY_A
);

lrg_ui_event_free(key_down);
lrg_ui_event_free(key_up);
```

### Scroll Events

```c
LrgUIEvent *scroll = lrg_ui_event_new_scroll(
    150.0f, 200.0f,  /* position */
    0.0f, -5.0f      /* scroll_x, scroll_y (negative = down) */
);

gfloat scroll_x = lrg_ui_event_get_scroll_x(scroll);
gfloat scroll_y = lrg_ui_event_get_scroll_y(scroll);

lrg_ui_event_free(scroll);
```

### Focus Events

```c
LrgUIEvent *focus_in = lrg_ui_event_new_focus_in();
LrgUIEvent *focus_out = lrg_ui_event_new_focus_out();

lrg_ui_event_free(focus_in);
lrg_ui_event_free(focus_out);
```

## Querying Events

### Event Type

```c
LrgUIEventType type = lrg_ui_event_get_event_type(event);

switch (type)
{
    case LRG_UI_EVENT_MOUSE_MOVE:
        g_message("Mouse moved");
        break;
    case LRG_UI_EVENT_MOUSE_BUTTON_DOWN:
        g_message("Mouse button pressed");
        break;
    case LRG_UI_EVENT_MOUSE_BUTTON_UP:
        g_message("Mouse button released");
        break;
    case LRG_UI_EVENT_KEY_DOWN:
        g_message("Key pressed");
        break;
    case LRG_UI_EVENT_KEY_UP:
        g_message("Key released");
        break;
    case LRG_UI_EVENT_SCROLL:
        g_message("Scrolled");
        break;
    case LRG_UI_EVENT_FOCUS_IN:
        g_message("Gained focus");
        break;
    case LRG_UI_EVENT_FOCUS_OUT:
        g_message("Lost focus");
        break;
    default:
        break;
}
```

### Mouse Properties

```c
if (type == LRG_UI_EVENT_MOUSE_BUTTON_DOWN)
{
    gint button = lrg_ui_event_get_button(event);
    gfloat x = lrg_ui_event_get_x(event);
    gfloat y = lrg_ui_event_get_y(event);
}

if (type == LRG_UI_EVENT_MOUSE_MOVE)
{
    gfloat x = lrg_ui_event_get_x(event);
    gfloat y = lrg_ui_event_get_y(event);
}

if (type == LRG_UI_EVENT_SCROLL)
{
    gfloat scroll_x = lrg_ui_event_get_scroll_x(event);
    gfloat scroll_y = lrg_ui_event_get_scroll_y(event);
}
```

### Keyboard Properties

```c
if (type == LRG_UI_EVENT_KEY_DOWN || type == LRG_UI_EVENT_KEY_UP)
{
    GrlKey key = lrg_ui_event_get_key(event);
}
```

## Event Consumption

Events can be marked as consumed to prevent further propagation:

```c
void my_widget_handle_event(LrgWidget *self, const LrgUIEvent *event)
{
    LrgUIEventType type = lrg_ui_event_get_event_type(event);

    if (type == LRG_UI_EVENT_MOUSE_BUTTON_DOWN)
    {
        g_message("Widget handled the click");
        lrg_ui_event_consume(event);
        return TRUE;
    }

    return FALSE;  /* Not consumed, parent gets it */
}
```

### Checking Consumption State

```c
if (lrg_ui_event_get_consumed(event))
{
    g_message("Event was already consumed");
}
```

## Copying Events

```c
g_autoptr(LrgUIEvent) original = lrg_ui_event_new_mouse_move(100, 200);
g_autoptr(LrgUIEvent) copy = lrg_ui_event_copy(original);

/* Both are independent */
gfloat x1 = lrg_ui_event_get_x(original);
gfloat x2 = lrg_ui_event_get_x(copy);
g_assert_cmpfloat(x1, ==, x2);
```

## Event Dispatch Flow

```
Canvas receives input
    ↓
Canvas::handle_input() creates UI events
    ↓
Canvas dispatches to widgets using hit testing
    ↓
Widget::handle_event() is called
    ↓
If consumed, event stops propagating
If not consumed, parent widget gets it
    ↓
Event processing complete
```

## Common Patterns

### Button Click Handling

```c
gboolean my_button_handle_event(LrgWidget *self,
                                const LrgUIEvent *event)
{
    LrgUIEventType type = lrg_ui_event_get_event_type(event);

    if (type == LRG_UI_EVENT_MOUSE_BUTTON_DOWN)
    {
        gint button = lrg_ui_event_get_button(event);
        if (button == 0)  /* left click */
        {
            g_message("Button clicked");
            g_signal_emit(self, signals[CLICKED], 0);
            lrg_ui_event_consume(event);
            return TRUE;
        }
    }

    return FALSE;
}
```

### Text Input Handling

```c
gboolean my_text_input_handle_event(LrgWidget *self,
                                    const LrgUIEvent *event)
{
    LrgUIEventType type = lrg_ui_event_get_event_type(event);

    if (type == LRG_UI_EVENT_KEY_DOWN)
    {
        GrlKey key = lrg_ui_event_get_key(event);

        switch (key)
        {
            case GRL_KEY_ENTER:
                g_message("Enter pressed");
                lrg_ui_event_consume(event);
                return TRUE;

            case GRL_KEY_BACKSPACE:
                /* Delete character */
                lrg_ui_event_consume(event);
                return TRUE;

            default:
                /* Regular character */
                break;
        }
    }

    return FALSE;
}
```

### Event Logging

```c
void log_event(const LrgUIEvent *event)
{
    LrgUIEventType type = lrg_ui_event_get_event_type(event);
    const gchar *type_str = "UNKNOWN";

    switch (type)
    {
        case LRG_UI_EVENT_MOUSE_MOVE:
            type_str = "MOUSE_MOVE";
            break;
        case LRG_UI_EVENT_MOUSE_BUTTON_DOWN:
            type_str = "MOUSE_BUTTON_DOWN";
            break;
        case LRG_UI_EVENT_MOUSE_BUTTON_UP:
            type_str = "MOUSE_BUTTON_UP";
            break;
        /* ... etc ... */
        default:
            break;
    }

    g_message("Event: %s at (%.0f, %.0f)",
              type_str,
              lrg_ui_event_get_x(event),
              lrg_ui_event_get_y(event));
}
```

## API Reference

### Construction

- `lrg_ui_event_new(LrgUIEventType type)`
- `lrg_ui_event_new_mouse_move(gfloat x, gfloat y)`
- `lrg_ui_event_new_mouse_button(LrgUIEventType type, gint button, gfloat x, gfloat y)`
- `lrg_ui_event_new_key(LrgUIEventType type, GrlKey key)`
- `lrg_ui_event_new_scroll(gfloat x, gfloat y, gfloat scroll_x, gfloat scroll_y)`
- `lrg_ui_event_new_focus_in()`
- `lrg_ui_event_new_focus_out()`

### Copy/Free

- `lrg_ui_event_copy(const LrgUIEvent *self)`
- `lrg_ui_event_free(LrgUIEvent *self)`

### Accessors

- `lrg_ui_event_get_event_type(const LrgUIEvent *self)`
- `lrg_ui_event_get_x(const LrgUIEvent *self)`
- `lrg_ui_event_get_y(const LrgUIEvent *self)`
- `lrg_ui_event_get_button(const LrgUIEvent *self)`
- `lrg_ui_event_get_key(const LrgUIEvent *self)`
- `lrg_ui_event_get_scroll_x(const LrgUIEvent *self)`
- `lrg_ui_event_get_scroll_y(const LrgUIEvent *self)`

### Consumption

- `lrg_ui_event_get_consumed(const LrgUIEvent *self)`
- `lrg_ui_event_set_consumed(LrgUIEvent *self, gboolean consumed)`
- `lrg_ui_event_consume(LrgUIEvent *self)`

## Notes

- Events are value types (not reference-counted)
- Must be freed with `lrg_ui_event_free()`
- Use `g_autoptr()` for automatic cleanup
- Consumption prevents parent widget processing
- Canvas automatically dispatches events to widgets

## Related

- [Widget](widget.md) - Widget event handling
- [Canvas Documentation](../../../TODO) - Root container and event dispatch
- [UI Module Overview](index.md) - Complete UI documentation
